/* ==========================
   THEME TOGGLE
========================== */
const toggleBtn = document.getElementById("themeToggle");

if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark-theme");
}

toggleBtn?.addEventListener("click", () => {
    document.body.classList.toggle("dark-theme");
    localStorage.setItem(
        "theme",
        document.body.classList.contains("dark-theme") ? "dark" : "light"
    );
});

/* ==========================
   DASHBOARD USER NAME
========================== */
const currentUser = localStorage.getItem("currentUser");
if (currentUser) {
    const userData = JSON.parse(localStorage.getItem(currentUser));
    const userNameEl = document.querySelector("header h2");
    if (userNameEl) userNameEl.textContent = `Welcome, ${userData.name} ðŸŒ±`;
}

/* ==========================
   AI CHATBOX
========================== */
const chatIcon = document.getElementById("aiChatIcon");
const chatBox = document.getElementById("aiChatBox");
const closeChat = document.getElementById("closeChat");
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");
const sendBtn = document.getElementById("sendBtn");

// Replace below with your API key & CX if you want JSON API
// For now, using Google CSE snippet (frontend)
const API_KEY = "AIzaSyBTUsfAEpavRKLuNOdWbkSDtew5ohFsIpY";
const CX = "5167dd19fa495415f";

chatIcon?.addEventListener("click", () => {
    chatBox.classList.toggle("hidden");
});

closeChat?.addEventListener("click", () => {
    chatBox.classList.add("hidden");
});

sendBtn?.addEventListener("click", async () => {
    const msg = chatInput.value.trim();
    if (!msg) return;

    addMsg("You", msg);
    chatInput.value = "";

    addMsg("EcoBot ðŸ¤–", "Searching online...");

    // Using Google Custom Search JSON API
    try {
        const res = await fetch(
            `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(msg)}`
        );
        const data = await res.json();

        let reply = "I couldn't find anything ðŸ˜•";
        if (data.items && data.items.length > 0) {
            reply = data.items[0].snippet;
        }

        updateLastMessage("EcoBot ðŸ¤–", reply);

    } catch (err) {
        console.error(err);
        updateLastMessage("EcoBot ðŸ¤–", "Error fetching info from Google ðŸ˜•");
    }
});

function addMsg(sender, text) {
    const div = document.createElement("div");
    div.textContent = `${sender}: ${text}`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function updateLastMessage(sender, text) {
    if (chatMessages.lastChild) {
        chatMessages.lastChild.textContent = `${sender}: ${text}`;
    }
}

/* ==========================
   CALCULATORS PLACEHOLDER
========================== */
// You can add your Carbon, Water, Energy, Eco Score calculator functions here
// Example Carbon Calculator (to be used in carbon.html):
/*
document.getElementById("calcCarbonBtn")?.addEventListener("click", () => {
    const transport = Number(document.getElementById("transport").value || 0);
    const food = document.getElementById("food").value === "veg" ? 5 : 10;
    const ac = Number(document.getElementById("ac").value || 0);
    const shower = Number(document.getElementById("shower").value || 0);

    const total = transport * 0.21 + food + ac * 1.5 + shower * 0.08;

    document.getElementById("carbonResult").textContent =
        `Your COâ‚‚ Today: ${total.toFixed(2)} kg`;

    document.getElementById("carbonTip").textContent =
        total > 20 ? "Reduce AC & car usage" : "Great eco habits!";
});
*/


